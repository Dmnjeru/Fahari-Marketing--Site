{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/njeru/fahari-marketing-site/frontend/src/app/admin/layout.tsx"],"sourcesContent":["// frontend/src/app/admin/layout.tsx\r\n// src/app/admin/AdminLayout.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { usePathname, useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport \"../globals.css\";\r\n\r\nexport const metadata = { title: \"Admin — Fahari Yoghurt\" };\r\n\r\ninterface AdminUser {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  role: string;\r\n}\r\n\r\nexport default function AdminLayout({ children }: { children: React.ReactNode }) {\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const [admin, setAdmin] = useState<AdminUser | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    async function verifyAdmin() {\r\n      try {\r\n        const res = await fetch(\"http://localhost:5000/api/admin/me\", {\r\n          method: \"GET\",\r\n          credentials: \"include\", // ✅ send HttpOnly cookies\r\n        });\r\n\r\n        if (res.status === 401) {\r\n          // try refreshing token\r\n          const refreshRes = await fetch(\"http://localhost:5000/api/admin/refresh\", {\r\n            method: \"POST\",\r\n            credentials: \"include\",\r\n          });\r\n\r\n          if (!refreshRes.ok) {\r\n            router.push(\"/admin/login\"); // redirect if refresh fails\r\n            return;\r\n          }\r\n\r\n          const refreshData = await refreshRes.json();\r\n          if (refreshData.success) {\r\n            // Retry /me after refresh\r\n            const retry = await fetch(\"http://localhost:5000/api/admin/me\", {\r\n              method: \"GET\",\r\n              credentials: \"include\",\r\n            });\r\n            if (!retry.ok) {\r\n              router.push(\"/admin/login\");\r\n              return;\r\n            }\r\n            const data = await retry.json();\r\n            setAdmin(data.user);\r\n          } else {\r\n            router.push(\"/admin/login\");\r\n          }\r\n        } else {\r\n          const data = await res.json();\r\n          if (data.success) setAdmin(data.user);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Admin verify error:\", err);\r\n        router.push(\"/admin/login\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n\r\n    verifyAdmin();\r\n  }, [router]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen\">\r\n        <p className=\"text-blue-600 font-semibold text-lg\">Loading admin...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!admin) {\r\n    return null; // redirecting, don't render layout\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex\">\r\n      {/* Sidebar */}\r\n      <aside className=\"w-64 bg-gray-900 text-white p-6 flex flex-col\">\r\n        <h2 className=\"text-2xl font-bold mb-6\">Fahari Admin</h2>\r\n        <nav className=\"flex-1 space-y-3\">\r\n          <Link\r\n            href=\"/admin/dashboard\"\r\n            className={`block p-2 rounded hover:bg-gray-700 ${\r\n              pathname.startsWith(\"/admin/dashboard\") ? \"bg-gray-700\" : \"\"\r\n            }`}\r\n          >\r\n            Dashboard\r\n          </Link>\r\n          <Link\r\n            href=\"/admin/products\"\r\n            className={`block p-2 rounded hover:bg-gray-700 ${\r\n              pathname.startsWith(\"/admin/products\") ? \"bg-gray-700\" : \"\"\r\n            }`}\r\n          >\r\n            Products\r\n          </Link>\r\n          <Link\r\n            href=\"/admin/orders\"\r\n            className={`block p-2 rounded hover:bg-gray-700 ${\r\n              pathname.startsWith(\"/admin/orders\") ? \"bg-gray-700\" : \"\"\r\n            }`}\r\n          >\r\n            Orders\r\n          </Link>\r\n          <Link\r\n            href=\"/admin/users\"\r\n            className={`block p-2 rounded hover:bg-gray-700 ${\r\n              pathname.startsWith(\"/admin/users\") ? \"bg-gray-700\" : \"\"\r\n            }`}\r\n          >\r\n            Users\r\n          </Link>\r\n          <Link\r\n            href=\"/admin/payments\"\r\n            className={`block p-2 rounded hover:bg-gray-700 ${\r\n              pathname.startsWith(\"/admin/payments\") ? \"bg-gray-700\" : \"\"\r\n            }`}\r\n          >\r\n            Payments\r\n          </Link>\r\n        </nav>\r\n\r\n        <button\r\n          onClick={async () => {\r\n            await fetch(\"http://localhost:5000/api/admin/logout\", {\r\n              method: \"POST\",\r\n              credentials: \"include\",\r\n            });\r\n            router.push(\"/admin/login\");\r\n          }}\r\n          className=\"mt-auto p-2 bg-red-600 hover:bg-red-700 rounded\"\r\n        >\r\n          Logout\r\n        </button>\r\n      </aside>\r\n\r\n      {/* Main content */}\r\n      <main className=\"flex-1 bg-gray-100 p-6\">{children}</main>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}